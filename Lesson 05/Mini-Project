Improved from previous version using Functions.
